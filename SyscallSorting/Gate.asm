.code

PrepareSyscall PROC

  xor r11, r11    ; clear registers
  xor r10, r10
  mov r11, rcx    ; ssn
  mov r10, rdx    ; syscall ret gadget address
  ret

PrepareSyscall ENDP

DoSyscallAllocVirtual PROC

  push r10        ; push syscall ret gadget address to stack
  xor rax, rax    ; clear rax
  mov r10, rcx    ; syscall clears rcx, so we must use r10
  mov eax, r11d   ; move ssn into eax
  ret             ; return and go to syscall ret gadget

DoSyscallAllocVirtual ENDP

DoSyscallProtectVirtual PROC

  push r10        ; push syscall ret gadget address to stack
  xor rax, rax    ; clear rax
  mov r10, rcx    ; syscall clears rcx, so we must use r10
  mov eax, r11d   ; move ssn into eax
  ret             ; return and go to syscall ret gadget

DoSyscallProtectVirtual ENDP

end
