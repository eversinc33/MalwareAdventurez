import std/strformat, helpers

proc get_stub*(shellcode: seq[byte], secret: string): string =
    var encoded: seq[byte] = @[]

    for i, b in shellcode:
        encoded.add(
            byte(b xor uint8(ord(char(secret[i mod secret.len])))))

    return   get_shellcode_str(encoded) & fmt"""

let secret = "{secret}"

# decrypt encoded shellcode
var shellcode: array[{len(encoded)}, byte] 
for i, b in encoded_shellcode:
    shellcode[i] = byte(b xor uint8(ord(char(secret[i mod secret.len]))))
    """